from data_provider import influxdb_api
import pandas as pd
import numpy as np

if __name__ == '__main__':
    starts = ['2023-10-03T08:00:00z', '2023-10-03T20:00:00z', '2023-10-04T08:00:00z', '2023-10-04T20:00:00z', '2023-10-05T08:00:00z', '2023-10-05T20:00:00z', '2023-10-06T08:00:00z', '2023-10-06T20:00:00z', '2023-10-07T08:00:00z', '2023-10-07T20:00:00z', '2023-10-08T08:00:00z', '2023-10-08T20:00:00z', '2023-10-09T08:00:00z', '2023-10-09T20:00:00z', '2023-10-10T08:00:00z', '2023-10-10T20:00:00z', '2023-10-11T08:00:00z', '2023-10-11T20:00:00z', '2023-10-12T08:00:00z', '2023-10-12T20:00:00z', '2023-10-13T08:00:00z', '2023-10-13T20:00:00z', '2023-10-14T08:00:00z', '2023-10-14T20:00:00z', '2023-10-15T08:00:00z', '2023-10-15T20:00:00z', '2023-10-16T08:00:00z', '2023-10-16T20:00:00z', '2023-10-17T08:00:00z', '2023-10-17T20:00:00z', '2023-10-18T08:00:00z', '2023-10-18T20:00:00z', '2023-10-19T08:00:00z', '2023-10-19T20:00:00z', '2023-10-20T08:00:00z', '2023-10-20T20:00:00z', '2023-10-21T08:00:00z', '2023-10-21T20:00:00z', '2023-10-22T08:00:00z', '2023-10-22T20:00:00z', '2023-10-23T08:00:00z', '2023-10-23T20:00:00z', '2023-10-24T08:00:00z', '2023-10-24T20:00:00z', '2023-10-25T08:00:00z', '2023-10-25T20:00:00z', '2023-10-26T08:00:00z', '2023-10-26T20:00:00z', '2023-10-27T08:00:00z', '2023-10-27T20:00:00z', '2023-10-28T08:00:00z', '2023-10-28T20:00:00z', '2023-10-29T08:00:00z', '2023-10-29T20:00:00z', '2023-10-30T08:00:00z', '2023-10-30T20:00:00z', '2023-10-31T08:00:00z', '2023-10-31T20:00:00z']
    ends = ['2023-10-03T20:00:00z', '2023-10-04T08:00:00z', '2023-10-04T20:00:00z', '2023-10-05T08:00:00z', '2023-10-05T20:00:00z', '2023-10-06T08:00:00z', '2023-10-06T20:00:00z', '2023-10-07T08:00:00z', '2023-10-07T20:00:00z', '2023-10-08T08:00:00z', '2023-10-08T20:00:00z', '2023-10-09T08:00:00z', '2023-10-09T20:00:00z', '2023-10-10T08:00:00z', '2023-10-10T20:00:00z', '2023-10-11T08:00:00z', '2023-10-11T20:00:00z', '2023-10-12T08:00:00z', '2023-10-12T20:00:00z', '2023-10-13T08:00:00z', '2023-10-13T20:00:00z', '2023-10-14T08:00:00z', '2023-10-14T20:00:00z', '2023-10-15T08:00:00z', '2023-10-15T20:00:00z', '2023-10-16T08:00:00z', '2023-10-16T20:00:00z', '2023-10-17T08:00:00z', '2023-10-17T20:00:00z', '2023-10-18T08:00:00z', '2023-10-18T20:00:00z', '2023-10-19T08:00:00z', '2023-10-19T20:00:00z', '2023-10-20T08:00:00z', '2023-10-20T20:00:00z', '2023-10-21T08:00:00z', '2023-10-21T20:00:00z', '2023-10-22T08:00:00z', '2023-10-22T20:00:00z', '2023-10-23T08:00:00z', '2023-10-23T20:00:00z', '2023-10-24T08:00:00z', '2023-10-24T20:00:00z', '2023-10-25T08:00:00z', '2023-10-25T20:00:00z', '2023-10-26T08:00:00z', '2023-10-26T20:00:00z', '2023-10-27T08:00:00z', '2023-10-27T20:00:00z', '2023-10-28T08:00:00z', '2023-10-28T20:00:00z', '2023-10-29T08:00:00z', '2023-10-29T20:00:00z', '2023-10-30T08:00:00z', '2023-10-30T20:00:00z', '2023-10-31T08:00:00z', '2023-10-31T20:00:00z', '2023-11-01T08:00:00z']
    df_raw = pd.DataFrame()
    for start, end in zip(starts, ends):
        query_api = influxdb_api.init_query_api(influxdb_api.url, influxdb_api.token)
        qc = influxdb_api.get_cluster_avg_power(start, end)
        cluster_avg_power = influxdb_api.execute_query(query_api, qc)
        df_raw = pd.concat([df_raw, cluster_avg_power], axis=0, ignore_index=True)
    # df_raw的第一列是时间戳，第二列也就是最后一列是数据中心的平均功耗
    # save df_raw as csv
    df_raw.to_csv('dataset/server.csv', index=False)
